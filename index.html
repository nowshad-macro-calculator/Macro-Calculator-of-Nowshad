
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Nowshad's Macro Calculator</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    :root{
      --bg1:#0b3aa8; --bg2:#071a4b;
      --card:rgba(255,255,255,.10);
      --stroke:rgba(255,255,255,.18);
      --text:#eef3ff; --muted:rgba(238,243,255,.75);
      --good:#3ddc97; --warn:#ffcc66; --bad:#ff6b6b;
      --shadow:0 18px 55px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 700px at 15% 0%, #1b63ff33 0%, transparent 60%),
                  radial-gradient(900px 600px at 90% 10%, #3ddc9730 0%, transparent 55%),
                  linear-gradient(145deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }
    .wrap{max-width:1100px; margin:0 auto; padding:18px 14px 70px;}
    .topbar{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding:14px 16px; border:1px solid var(--stroke); background:var(--card);
      border-radius:var(--radius); box-shadow:var(--shadow);
      position:sticky; top:10px; z-index:50; backdrop-filter: blur(10px);
    }
    .brand{display:flex; flex-direction:column; gap:2px}
    .brand h1{font-size:16px; margin:0; letter-spacing:.2px; font-weight:800}
    .brand span{font-size:12px; color:var(--muted)}
    .tabs{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end}
    .tabbtn{
      padding:10px 12px; border-radius:12px;
      border:1px solid var(--stroke); background:rgba(255,255,255,.08);
      color:var(--text); cursor:pointer; font-weight:700; font-size:13px;
      transition:.15s transform, .15s background;
    }
    .tabbtn:hover{transform:translateY(-1px); background:rgba(255,255,255,.12)}
    .tabbtn.active{background:rgba(255,255,255,.18)}
    .grid{display:grid; gap:14px}
    @media (min-width: 920px){
      .grid.cols2{grid-template-columns:1.05fr .95fr}
      .grid.cols3{grid-template-columns:1fr 1fr 1fr}
    }
    .card{
      border:1px solid var(--stroke);
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
    }
    .card h2{margin:0 0 10px; font-size:15px}
    .card h3{margin:0 0 10px; font-size:14px; color:#d9e7ff}
    .sub{color:var(--muted); font-size:12px; line-height:1.35}
    .row{display:grid; gap:10px}
    @media (min-width: 640px){
      .row.cols2{grid-template-columns:1fr 1fr}
      .row.cols3{grid-template-columns:1fr 1fr 1fr}
    }
    label{font-size:12px; color:var(--muted); display:block; margin-bottom:6px}
    input, select{
      width:100%;
      padding:11px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.20);
      background:rgba(10,20,60,.45);
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    input::placeholder{color:rgba(238,243,255,.55)}
    input[readonly]{opacity:.95}
    .btn{
      padding:11px 12px; border-radius:12px; border:1px solid var(--stroke);
      background:rgba(255,255,255,.14); color:var(--text);
      cursor:pointer; font-weight:800;
    }
    .btn:hover{background:rgba(255,255,255,.18)}
    .btn.danger{background:rgba(255,107,107,.18)}
    .btn.danger:hover{background:rgba(255,107,107,.26)}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--stroke); border-radius:999px;
      padding:8px 10px; background:rgba(255,255,255,.08);
      font-size:12px; color:var(--muted)
    }
    .kpi{
      display:flex; flex-direction:column; gap:6px; padding:12px;
      border:1px solid var(--stroke); border-radius:16px;
      background:rgba(255,255,255,.10);
    }
    .kpi .big{font-size:18px; font-weight:800; letter-spacing:.2px}
    .kpi .cap{font-size:12px; color:var(--muted)}
    .accentGood{color:var(--good)}
    .accentBad{color:var(--bad)}
    .divider{height:1px; background:rgba(255,255,255,.14); margin:10px 0}
    .hide{display:none !important}
    .bmiBar{
      height:10px; border-radius:999px; overflow:hidden; background:rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.16);
    }
    .bmiFill{height:100%; width:0%; background:linear-gradient(90deg, var(--bad), var(--warn), var(--good), var(--warn), var(--bad))}
    .bmiMarker{position:relative; height:14px; margin-top:6px;}
    .bmiMarker span{
      position:absolute; top:0; transform:translateX(-50%);
      font-size:11px; color:var(--muted)
    }
    .chartBox{
      height:260px;
      border:1px solid rgba(255,255,255,.16);
      border-radius:16px;
      background:rgba(255,255,255,.06);
      padding:10px;
    }
    canvas{max-width:100% !important}
    .note{
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      background:rgba(61,220,151,.12);
      border:1px solid rgba(61,220,151,.28);
      color:#dffaf0;
      font-size:12px;
    }
    .warnNote{
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      background:rgba(255,204,102,.14);
      border:1px solid rgba(255,204,102,.30);
      color:#fff4dc;
      font-size:12px;
    }
    .tableWrap{
      border:1px solid rgba(255,255,255,.16);
      border-radius:16px;
      overflow:auto;
      background:rgba(255,255,255,.06);
    }
    table{width:100%; border-collapse:collapse; min-width:760px;}
    th, td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.10);
      text-align:left;
      font-size:12px;
      color:rgba(238,243,255,.92);
      vertical-align:middle;
    }
    th{color:rgba(238,243,255,.75); font-weight:800; background:rgba(255,255,255,.06)}
    .miniInput{
      width:90px; padding:8px 8px; border-radius:10px; font-size:12px;
    }
    .actionBtn{
      padding:8px 10px; border-radius:10px; border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.10); color:var(--text); cursor:pointer; font-weight:800; font-size:12px;
    }
    .actionBtn:hover{background:rgba(255,255,255,.14)}
    .twoBtnRow{display:flex; gap:10px; flex-wrap:wrap}
    .smallBtn{padding:9px 10px; font-size:12px}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <h1>Nowshad's Macro Calculator</h1>
        <span>Profile → Food Log → Lifestyle → Dashboard + PDF</span>
      </div>
      <div class="tabs">
        <button class="tabbtn active" data-page="dashboard">Dashboard</button>
        <button class="tabbtn" data-page="profile">Profile</button>
        <button class="tabbtn" data-page="food">Food Log</button>
        <button class="tabbtn" data-page="lifestyle">Lifestyle</button>
      </div>
    </div>

    <!-- DASHBOARD -->
    <section id="page-dashboard" class="grid cols2" style="margin-top:14px;">
      <div class="card">
        <h2>Today’s Dashboard</h2>
        <div class="sub">Targets use selected Profile. Dashboard uses your “day start hour” to define “today”.</div>

        <div class="divider"></div>

        <div class="twoBtnRow">
          <button class="btn smallBtn danger" onclick="resetOnlyToday()">Reset Only Today</button>
          <button class="btn smallBtn danger" onclick="resetEverything()">Reset Everything</button>
        </div>

        <div class="warnNote" id="needProfileNote" style="display:none;">
          No saved profile selected. Go to <b>Profile</b> tab → create/select a profile → press <b>Calculate Targets</b> or <b>Save Profile</b>.
        </div>

        <div class="divider"></div>

        <div class="row cols3">
          <div class="kpi">
            <div class="cap">Calories eaten</div>
            <div class="big" id="dashCalories">0 kcal</div>
            <div class="cap">Target: <span id="dashCalTarget">0</span> kcal</div>
          </div>
          <div class="kpi">
            <div class="cap">Workout burned</div>
            <div class="big" id="dashBurn">0 kcal</div>
            <div class="cap">Net: <span id="dashNet">0</span> kcal</div>
          </div>
          <div class="kpi">
            <div class="cap">Protein eaten</div>
            <div class="big" id="dashProtein">0 g</div>
            <div class="cap">Target: <span id="dashProtTarget">0</span> g</div>
          </div>
        </div>

        <div class="row cols3" style="margin-top:10px">
          <div class="kpi">
            <div class="cap">Carbs eaten</div>
            <div class="big" id="dashCarbs">0 g</div>
            <div class="cap">Target: <span id="dashCarbTarget">0</span> g</div>
          </div>
          <div class="kpi">
            <div class="cap">Fat eaten</div>
            <div class="big" id="dashFat">0 g</div>
            <div class="cap">Target: <span id="dashFatTarget">0</span> g</div>
          </div>
          <div class="kpi">
            <div class="cap">Net vs Target (calories)</div>
            <div class="big" id="dashCalBalance">—</div>
            <div class="cap" id="dashCalBalanceMsg">Set profile targets first.</div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row cols3">
          <div class="kpi">
            <div class="cap">Protein balance</div>
            <div class="big" id="dashProtBalance">—</div>
            <div class="cap" id="dashProtBalanceMsg">—</div>
          </div>
          <div class="kpi">
            <div class="cap">Carbs balance</div>
            <div class="big" id="dashCarbBalance">—</div>
            <div class="cap" id="dashCarbBalanceMsg">—</div>
          </div>
          <div class="kpi">
            <div class="cap">Fat balance</div>
            <div class="big" id="dashFatBalance">—</div>
            <div class="cap" id="dashFatBalanceMsg">—</div>
          </div>
        </div>

        <div class="divider"></div>

        <!-- ✅ FIX: Lifestyle summary on Dashboard -->
        <h3>Lifestyle Summary (Today)</h3>
        <div class="sub">This pulls from Lifestyle tab for the same “day start hour”.</div>
        <div class="row cols2" style="margin-top:10px">
          <div class="kpi">
            <div class="cap">Workout (multiple supported)</div>
            <div class="big" id="dashLifeWorkout">—</div>
            <div class="cap" id="dashLifeWorkoutSub">—</div>
          </div>
          <div class="kpi">
            <div class="cap">Sleep & Water</div>
            <div class="big" id="dashLifeSleepWater">—</div>
            <div class="cap" id="dashLifeSleepWaterSub">—</div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row cols3">
          <div class="pill">BMI: <b id="dashBMI">—</b></div>
          <div class="pill">BMR: <b id="dashBMR">—</b> kcal</div>
          <div class="pill">TDEE: <b id="dashTDEE">—</b> kcal</div>
        </div>

        <div style="margin-top:10px" class="sub">
          Recommended BMI range: <b>18.5–24.9</b>. Your BMI marker is shown below.
        </div>

        <div style="margin-top:10px">
          <div class="bmiBar"><div class="bmiFill" id="bmiFill"></div></div>
          <div class="bmiMarker">
            <span style="left:18.5%">18.5</span>
            <span style="left:24.9%">24.9</span>
            <span id="bmiPin" style="left:0%">▲ You</span>
          </div>
        </div>

        <div class="note" id="profileSavedNote" style="display:none;">
          Profile saved ✔️ You won’t need to re-enter your details on this device.
        </div>

        <div class="divider"></div>

        <button class="btn" onclick="savePDF()">Save PDF Report</button>
      </div>

      <div class="card">
        <h2>Macro Chart</h2>
        <div class="sub">Stable chart on scroll. Colors are distinct and NOT blue.</div>
        <div class="chartBox">
          <canvas id="macroChart"></canvas>
        </div>

        <div class="divider"></div>

        <h3>Quick Profile (Read-only)</h3>
        <div class="sub">Profile details are managed in the Profile tab.</div>
        <div class="row cols2" style="margin-top:10px">
          <div class="kpi">
            <div class="cap">Selected profile</div>
            <div class="big" id="dashProfileName">—</div>
            <div class="cap" id="dashProfileMeta">—</div>
          </div>
          <div class="kpi">
            <div class="cap">Protein multiplier</div>
            <div class="big" id="dashProtMult">—</div>
            <div class="cap">g/kg</div>
          </div>
        </div>
      </div>
    </section>

    <!-- PROFILE -->
    <section id="page-profile" class="grid cols2 hide" style="margin-top:14px;">
      <div class="card">
        <h2>Profiles (Multi-user)</h2>
        <div class="sub">Create multiple profiles and switch anytime.</div>

        <div class="divider"></div>

        <div class="row cols2">
          <div>
            <label>Select profile</label>
            <select id="profileSelect"></select>
          </div>
          <div>
            <label>New profile name</label>
            <input id="newProfileName" placeholder="e.g., Nowshad / Aymaan / Guest">
          </div>
        </div>

        <div class="row cols2" style="margin-top:10px">
          <button class="btn" onclick="createProfile()">Create Profile</button>
          <button class="btn danger" onclick="resetCurrentProfile()">Reset Current Profile</button>
        </div>

        <div class="divider"></div>

        <h3>Profile Details</h3>
        <div class="sub">Press <b>Calculate Targets</b> to compute instantly (no save needed). Save only to keep it permanently.</div>

        <div class="divider"></div>

        <div class="row cols2">
          <div>
            <label>Name</label>
            <input id="p_name" placeholder="Enter your name">
          </div>
          <div>
            <label>Age</label>
            <input type="number" min="1" step="1" id="p_age" placeholder="Enter your age">
          </div>
        </div>

        <div class="row cols2" style="margin-top:10px">
          <div>
            <label>Height unit</label>
            <select id="p_height_unit">
              <option value="ftin" selected>Feet/Inches</option>
              <option value="cm">Centimeters (cm)</option>
            </select>
          </div>
          <div>
            <label>Weight unit</label>
            <select id="p_weight_unit">
              <option value="kg" selected>Kilograms (kg)</option>
              <option value="lbs">Pounds (lbs)</option>
            </select>
          </div>
        </div>

        <div class="row cols2 hide" style="margin-top:10px" id="height_cm_row">
          <div>
            <label>Height (cm)</label>
            <input type="number" min="0" step="0.1" id="p_height_cm" placeholder="e.g., 175">
          </div>
          <div class="hide"></div>
        </div>

        <div class="row cols2" style="margin-top:10px" id="height_ftin_row">
          <div>
            <label>Height (ft)</label>
            <input type="number" min="0" step="1" id="p_height_ft" placeholder="e.g., 5">
          </div>
          <div>
            <label>Height (in)</label>
            <input type="number" min="0" step="1" id="p_height_in" placeholder="e.g., 9">
          </div>
        </div>

        <div class="row cols2" style="margin-top:10px">
          <div id="weight_kg_row">
            <label>Weight (kg)</label>
            <input type="number" min="0" step="0.1" id="p_weight_kg" placeholder="e.g., 75">
          </div>
          <div id="weight_lbs_row" class="hide">
            <label>Weight (lbs)</label>
            <input type="number" min="0" step="0.1" id="p_weight_lbs" placeholder="e.g., 165">
          </div>
        </div>

        <div class="divider"></div>

        <div class="row cols2">
          <div>
            <label>Goal</label>
            <select id="p_goal">
              <option value="loss" selected>Weight loss</option>
              <option value="maintain">Maintenance</option>
              <option value="gain">Weight gain</option>
            </select>
          </div>
          <div>
            <label>Activity level</label>
            <select id="p_activity">
              <option value="1.2">Sedentary — little or no exercise</option>
              <option value="1.375">Light — exercise 1–3 times/week</option>
              <option value="1.55">Moderate — exercise 4–5 times/week</option>
              <option value="1.725">Active — daily exercise or intense 3–4 times/week</option>
              <option value="1.9">Very Active — intense exercise 6–7 times/week</option>
              <option value="2.0">Extra Active — very intense daily or physical job</option>
            </select>
          </div>
        </div>

        <div class="row cols3" style="margin-top:10px">
          <div>
            <label>Day starts at (hour)</label>
            <input type="number" min="0" max="23" step="1" id="p_dayStartHour" value="4">
          </div>
          <div>
            <label>Sex (for BMR)</label>
            <select id="p_sex">
              <option value="male" selected>Male</option>
              <option value="female">Female</option>
            </select>
          </div>
          <div>
            <label>Macro style</label>
            <select id="p_macroPreset">
              <option value="balanced">Balanced</option>
              <option value="higherCarb">Higher carb (bulking friendly)</option>
              <option value="higherProtein" selected>Higher protein</option>
            </select>
          </div>
        </div>

        <div class="divider"></div>

        <h3>Targets</h3>
        <div class="sub">Protein auto = weight × multiplier. Calories/Fats/Carbs can be auto OR manual.</div>

        <div class="row cols3" style="margin-top:10px">
          <div>
            <label>Target calories (auto, editable)</label>
            <input type="number" min="0" step="1" id="p_targetCalories" placeholder="Auto">
          </div>
          <div>
            <label>Target protein (g) — auto</label>
            <input type="number" id="p_targetProtein" readonly>
          </div>
          <div>
            <label>Target fats (g) (auto, editable)</label>
            <input type="number" min="0" step="1" id="p_targetFats" placeholder="Auto">
          </div>
        </div>

        <div class="row cols2" style="margin-top:10px">
          <div>
            <label>Target carbs (g) (auto, editable)</label>
            <input type="number" min="0" step="1" id="p_targetCarbs" placeholder="Auto">
          </div>
          <div>
            <label>Protein multiplier (g/kg) — default 2.2</label>
            <select id="p_protMult">
              <option value="1.5">1.5 g/kg</option>
              <option value="1.6">1.6 g/kg</option>
              <option value="1.8">1.8 g/kg</option>
              <option value="2.0">2.0 g/kg</option>
              <option value="2.2" selected>2.2 g/kg</option>
            </select>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row cols2">
          <button class="btn" onclick="calculateTargetsOnly()">Calculate Targets</button>
          <button class="btn" onclick="saveProfile()">Save Profile</button>
        </div>

        <div class="note" id="profileCalcHint" style="display:none;">
          Targets calculated ✔️ (not saved yet). Click Save Profile to keep permanently.
        </div>

        <div class="note" id="profileSaveHint" style="display:none;">
          Saved ✔️ Go to Food Log and add entries.
        </div>
      </div>

      <div class="card">
        <h2>Metrics (BMI • BMR • TDEE)</h2>
        <div class="row cols3">
          <div class="kpi"><div class="cap">BMI</div><div class="big" id="p_bmiLine">—</div><div class="cap">Recommended 18.5–24.9</div></div>
          <div class="kpi"><div class="cap">BMR</div><div class="big" id="p_bmrLine">—</div><div class="cap">Mifflin–St Jeor</div></div>
          <div class="kpi"><div class="cap">TDEE</div><div class="big" id="p_tdeeLine">—</div><div class="cap" id="p_targetLine">Target: —</div></div>
        </div>
        <div class="divider"></div>
        <div class="sub">TDEE = BMR × Activity Level. Target Calories = TDEE + goal adjustment.</div>
      </div>
    </section>

    <!-- FOOD LOG -->
    <section id="page-food" class="grid cols2 hide" style="margin-top:14px;">
      <div class="card">
        <h2>Food Log (Multiple entries/day)</h2>
        <div class="sub">Choose Category → Food → Unit → Qty → Add Entry (repeat anytime).</div>

        <div class="divider"></div>

        <div class="row cols2">
          <div>
            <label>Log date</label>
            <input type="date" id="logDate">
          </div>
          <div>
            <label>Meal type</label>
            <select id="mealType">
              <option>Breakfast</option>
              <option>Brunch</option>
              <option selected>Lunch</option>
              <option>Dinner</option>
              <option>Supper</option>
              <option>Pre-workout meal</option>
              <option>Post-workout meal</option>
              <option>Snacks</option>
            </select>
          </div>
        </div>

        <div class="divider"></div>

        <h3>Add Food Entry</h3>
        <div class="row cols2" style="margin-top:10px">
          <div>
            <label>Category</label>
            <select id="entryCategory"></select>
          </div>
          <div>
            <label>Food item</label>
            <select id="entryFood"></select>
          </div>
          <div>
            <label>Unit</label>
            <select id="entryUnit"></select>
          </div>
          <div>
            <label>Quantity</label>
            <input type="number" min="0" step="1" id="entryQty" placeholder="Enter qty">
          </div>
          <div>
            <label>&nbsp;</label>
            <button class="btn" onclick="addEntry()">Add Entry</button>
          </div>
        </div>

        <div class="pill" style="margin-top:10px">
          Instant preview: <b><span id="entryPrevP">0</span>g P</b> • <b><span id="entryPrevF">0</span>g F</b> • <b><span id="entryPrevC">0</span>g C</b> • <b><span id="entryPrevK">0</span> kcal</b>
        </div>

        <div class="divider"></div>

        <div class="row cols2">
          <button class="btn" onclick="saveDay()">Save for the Day</button>
          <button class="btn danger" onclick="resetFoodLogs()">Reset Food Logs</button>
        </div>

        <div class="divider"></div>

        <h3>Daily Entries</h3>
        <div class="sub">Edit quantity inline or delete any row.</div>
        <div class="tableWrap" style="margin-top:10px">
          <table>
            <thead>
              <tr>
                <th>Meal</th>
                <th>Category</th>
                <th>Food</th>
                <th>Qty</th>
                <th>Unit</th>
                <th>P (g)</th>
                <th>C (g)</th>
                <th>F (g)</th>
                <th>Kcal</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="entriesTbody"></tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <h2>Live Totals (Auto)</h2>
        <div class="sub">Totals are based on the entries table for the selected day.</div>

        <div class="divider"></div>

        <div class="row cols2">
          <div class="kpi"><div class="cap">Protein</div><div class="big" id="liveP">0 g</div></div>
          <div class="kpi"><div class="cap">Carbs</div><div class="big" id="liveC">0 g</div></div>
          <div class="kpi"><div class="cap">Fat</div><div class="big" id="liveF">0 g</div></div>
          <div class="kpi"><div class="cap">Calories</div><div class="big" id="liveK">0 kcal</div></div>
        </div>
      </div>
    </section>

    <!-- LIFESTYLE -->
    <section id="page-lifestyle" class="grid cols2 hide" style="margin-top:14px;">
      <div class="card">
        <h2>Lifestyle (Multiple Workouts • Sleep • Water)</h2>
        <div class="sub">Add multiple workouts (e.g., Cardio + Strength). Total burn updates Dashboard net calories.</div>

        <div class="divider"></div>

        <div class="row cols2">
          <div>
            <label>Date</label>
            <input type="date" id="lifeDate">
          </div>
          <div class="pill">
            Total burn today: <b><span id="burnTotalPreview">0</span> kcal</b>
          </div>
        </div>

        <div class="divider"></div>

        <h3>Add Workout</h3>
        <div class="row cols2">
          <div>
            <label>Workout type</label>
            <select id="workoutType">
              <option value="walking">Walking</option>
              <option value="running">Running</option>
              <option value="cycling">Cycling</option>
              <option value="aerobic">Aerobics</option>
              <option value="cardio">Cardio (general)</option>
              <option value="hiit">HIIT</option>
              <option value="strength" selected>Strength training</option>
            </select>
          </div>
          <div id="strengthSplitWrap">
            <label>Strength split</label>
            <select id="strengthSplit">
              <option value="chest_triceps">Chest + Triceps</option>
              <option value="back_biceps">Back + Biceps</option>
              <option value="shoulders_forearms">Shoulders + Forearms</option>
              <option value="legs">Legs</option>
              <option value="fullbody">Full body</option>
            </select>
          </div>
          <div>
            <label>Duration (minutes)</label>
            <input type="number" min="0" step="1" id="workoutMins" placeholder="e.g., 45">
          </div>
          <div>
            <label>&nbsp;</label>
            <button class="btn" onclick="addWorkout()">Add Workout</button>
          </div>
        </div>

        <div class="pill" style="margin-top:10px">
          This workout burn estimate: <b><span id="burnPreview">0</span> kcal</b>
        </div>

        <div class="divider"></div>

        <h3>Workouts List (Today)</h3>
        <div class="sub">You can add multiple workouts and delete any one.</div>
        <div class="tableWrap" style="margin-top:10px">
          <table style="min-width:640px;">
            <thead>
              <tr>
                <th>Type</th>
                <th>Split</th>
                <th>Minutes</th>
                <th>Burn (kcal)</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="workoutsTbody"></tbody>
          </table>
        </div>

        <div class="divider"></div>

        <h3>Sleep</h3>
        <div class="row cols2">
          <div>
            <label>Hours slept</label>
            <input type="number" min="0" step="0.1" id="sleepHours" placeholder="e.g., 7.5">
          </div>
          <div>
            <label>Sleep goal (hours)</label>
            <select id="sleepGoal">
              <option value="7">7</option>
              <option value="8" selected>8</option>
              <option value="9">9</option>
            </select>
          </div>
        </div>

        <div class="divider"></div>

        <h3>Water</h3>
        <div class="row cols2">
          <div>
            <label>Water intake (liters)</label>
            <input type="number" min="0" step="0.1" id="waterLiters" placeholder="e.g., 2.5">
          </div>
          <div>
            <label>Water goal (liters)</label>
            <select id="waterGoal">
              <option value="2">2.0</option>
              <option value="2.5">2.5</option>
              <option value="3" selected>3.0</option>
              <option value="3.5">3.5</option>
              <option value="4">4.0</option>
            </select>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row cols2">
          <button class="btn" onclick="saveLifestyle()">Save Lifestyle</button>
          <button class="btn danger" onclick="resetLifestyle()">Reset Lifestyle</button>
        </div>

        <div class="note" id="lifeSavedNote" style="display:none;">
          Lifestyle saved ✔️ Dashboard updated.
        </div>
      </div>

      <div class="card">
        <h2>Today’s Lifestyle Summary</h2>
        <div class="divider"></div>

        <div class="row cols2">
          <div class="kpi">
            <div class="cap">Workout summary</div>
            <div class="big" id="lifeWorkoutLine">—</div>
            <div class="cap" id="lifeWorkoutLineSub">—</div>
          </div>
          <div class="kpi">
            <div class="cap">Sleep / Water</div>
            <div class="big" id="lifeSleepWaterLine">—</div>
            <div class="cap" id="lifeSleepWaterLineSub">—</div>
          </div>
        </div>
      </div>
    </section>
  </div>

<script>
/* ===========================
   Storage Keys
=========================== */
const LS_PROFILES = "nowshad_profiles_v1";
const LS_ACTIVE_PROFILE = "nowshad_active_profile_v1";
const LS_LOG = "nowshad_macro_dailylog_v10";
const LS_LIFE = "nowshad_macro_lifestyle_v10";

/* ===== Helpers ===== */
const $ = (id)=>document.getElementById(id);
const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));
const n = (v)=>isFinite(parseFloat(v)) ? parseFloat(v) : 0;
const round1 = (x)=>Math.round(x*10)/10;
const round2 = (x)=>Math.round(x*100)/100;
function sum(a,b){ return {P:a.P+b.P, C:a.C+b.C, F:a.F+b.F, K:a.K+b.K}; }
function zero(){ return {P:0,C:0,F:0,K:0}; }
function uid(){ return (crypto?.randomUUID ? crypto.randomUUID() : String(Date.now())+Math.random()); }

/* ===========================
   Tabs
=========================== */
document.querySelectorAll(".tabbtn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    document.querySelectorAll(".tabbtn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    showPage(btn.dataset.page);
    scheduleRefresh();
  });
});
function showPage(name){
  ["dashboard","profile","food","lifestyle"].forEach(p=>{
    $("page-"+p).classList.toggle("hide", p!==name);
  });
}

/* ===========================
   Chart (no blue)
=========================== */
let macroChart=null;
(function initChart(){
  const ctx=$("macroChart").getContext("2d");
  macroChart=new Chart(ctx,{
    type:"bar",
    data:{
      labels:["Protein (g)","Carbs (g)","Fat (g)"],
      datasets:[{label:"Macros", data:[0,0,0], backgroundColor:["#3ddc97","#ffcc66","#ff6b6b"]}]
    },
    options:{
      responsive:true, maintainAspectRatio:false, animation:false,
      scales:{
        y:{beginAtZero:true, ticks:{color:"rgba(238,243,255,.8)"}, grid:{color:"rgba(255,255,255,.10)"}},
        x:{ticks:{color:"rgba(238,243,255,.8)"}, grid:{display:false}}
      },
      plugins:{ legend:{labels:{color:"rgba(238,243,255,.85)"}} }
    }
  });
})();

/* ===== Debounced refresh ===== */
let refreshTimer=null;
function scheduleRefresh(){
  if(refreshTimer) clearTimeout(refreshTimer);
  refreshTimer=setTimeout(()=>{ refreshAll(); }, 120);
}

/* ===========================
   Profiles DB
=========================== */
function loadProfiles(){ try { return JSON.parse(localStorage.getItem(LS_PROFILES) || "{}"); } catch(e){ return {}; } }
function saveProfiles(map){ localStorage.setItem(LS_PROFILES, JSON.stringify(map)); }
function getActiveProfileId(){ return localStorage.getItem(LS_ACTIVE_PROFILE) || ""; }
function setActiveProfileId(id){ localStorage.setItem(LS_ACTIVE_PROFILE, id); }
function getActiveProfile(){
  const map = loadProfiles();
  const id = getActiveProfileId();
  return (id && map[id]) ? map[id] : null;
}
function ensureDefaultProfile(){
  const map = loadProfiles();
  const active = getActiveProfileId();
  const ids = Object.keys(map);

  if(ids.length === 0){
    const id = uid();
    map[id] = { id, label:"Default", createdAt:Date.now() };
    saveProfiles(map);
    setActiveProfileId(id);
    return;
  }
  if(!active || !map[active]){
    setActiveProfileId(ids[0]);
  }
}

/* ===========================
   Manual overrides
=========================== */
function setDirty(id, val=true){ $(id).dataset.dirty = val ? "1" : ""; }
function isDirty(id){ return $(id).dataset.dirty === "1"; }

/* ===========================
   Unit readers + convert
=========================== */
function readWeightKg(){
  const u = $("p_weight_unit").value;
  const kg = n($("p_weight_kg").value);
  const lbs = n($("p_weight_lbs").value);
  return (u==="lbs") ? lbs*0.45359237 : kg;
}
function readHeightCm(){
  const u = $("p_height_unit").value;
  const cm = n($("p_height_cm").value);
  const ft = n($("p_height_ft").value);
  const inch = n($("p_height_in").value);
  return (u==="cm") ? cm : (ft*30.48 + inch*2.54);
}
function convertWeight(from,to){
  const kg = (from==="kg") ? n($("p_weight_kg").value) : n($("p_weight_lbs").value)*0.45359237;
  if(!kg) return;
  if(to==="kg"){ $("p_weight_kg").value = round1(kg); $("p_weight_lbs").value=""; }
  else { $("p_weight_lbs").value = round1(kg/0.45359237); $("p_weight_kg").value=""; }
}
function convertHeight(from,to){
  let cm = 0;
  if(from==="cm"){ cm = n($("p_height_cm").value); }
  else { cm = n($("p_height_ft").value)*30.48 + n($("p_height_in").value)*2.54; }
  if(!cm) return;
  if(to==="cm"){ $("p_height_cm").value = round1(cm); $("p_height_ft").value=""; $("p_height_in").value=""; }
  else {
    const totalIn = cm/2.54;
    const ft = Math.floor(totalIn/12);
    const inch = Math.round(totalIn - ft*12);
    $("p_height_ft").value = ft;
    $("p_height_in").value = inch;
    $("p_height_cm").value="";
  }
}

/* ===========================
   Profile calc
=========================== */
function getProfileDraft(){
  const sex=$("p_sex").value;
  const age=n($("p_age").value);

  const wkg = readWeightKg();
  const hcm = readHeightCm();
  const hm = hcm/100;

  const bmi=(wkg>0&&hm>0)?(wkg/(hm*hm)):0;

  let bmr=0;
  if(wkg>0 && hcm>0 && age>0){
    bmr = (10*wkg) + (6.25*hcm) - (5*age) + (sex==="male"?5:-161);
  }

  const activity=n($("p_activity").value);
  const tdee=bmr?bmr*activity:0;
  const basicsOk = (wkg>0 && hcm>0 && age>0 && tdee>0);

  const protMult = n($("p_protMult").value) || 2.2;
  const targetProtein = (wkg>0) ? Math.round((wkg * protMult)/5)*5 : 0;

  let targetCaloriesAuto = 0;
  if (basicsOk) {
    const goal = $("p_goal").value;
    const adj = goal === "gain" ? 400 : goal === "loss" ? -500 : 0;
    targetCaloriesAuto = Math.round(tdee + adj);
  }

  const targetCalories = (isDirty("p_targetCalories") && n($("p_targetCalories").value)>0)
    ? Math.max(800, Math.round(n($("p_targetCalories").value)))
    : targetCaloriesAuto;

  let fatPct = 0.30;
  const preset=$("p_macroPreset").value;
  if(preset==="higherCarb") fatPct = 0.25;
  if(preset==="higherProtein") fatPct = 0.25;

  let fatsAuto = 0;
  if(targetCalories>0){
    fatsAuto = Math.round((targetCalories * fatPct)/9);
  }
  let targetFats = (isDirty("p_targetFats") && n($("p_targetFats").value)>0)
    ? Math.max(0, Math.round(n($("p_targetFats").value)))
    : fatsAuto;

  let carbsAuto = 0;
  if(targetCalories>0 && targetProtein>0){
    let remaining = targetCalories - (targetProtein*4) - (targetFats*9);
    if(remaining < 0){
      targetFats = Math.max(0, Math.floor((targetCalories - targetProtein*4)/9));
      remaining = Math.max(0, targetCalories - (targetProtein*4) - (targetFats*9));
    }
    carbsAuto = Math.max(0, Math.round(remaining/4));
  }
  const targetCarbs = (isDirty("p_targetCarbs"))
    ? Math.max(0, Math.round(n($("p_targetCarbs").value)))
    : carbsAuto;

  return {
    id: getActiveProfileId(),
    label: ($("p_name").value || "").trim() || "Profile",
    name:$("p_name").value||"",
    sex, age,
    heightUnit:$("p_height_unit").value,
    weightUnit:$("p_weight_unit").value,
    height_cm:n($("p_height_cm").value),
    height_ft:n($("p_height_ft").value),
    height_in:n($("p_height_in").value),
    weight_kg:n($("p_weight_kg").value),
    weight_lbs:n($("p_weight_lbs").value),
    wkg, hm, bmi, bmr, tdee,
    goal:$("p_goal").value,
    activity,
    dayStartHour:clamp(parseInt($("p_dayStartHour").value||"4",10),0,23),
    macroPreset:$("p_macroPreset").value,
    protMult,
    targetCalories,
    targetProtein,
    targetFats,
    targetCarbs,
    dirtyCalories:isDirty("p_targetCalories"),
    dirtyFats:isDirty("p_targetFats"),
    dirtyCarbs:isDirty("p_targetCarbs"),
  };
}

/* ===== Profile UI toggles ===== */
function toggleHeightUI(doRecalc=true){
  const u=$("p_height_unit").value;
  $("height_cm_row").classList.toggle("hide", u!=="cm");
  $("height_ftin_row").classList.toggle("hide", u!=="ftin");
  if(doRecalc) updateProfilePreviewOnly();
}
function toggleWeightUI(doRecalc=true){
  const u=$("p_weight_unit").value;
  $("weight_kg_row").classList.toggle("hide", u!=="kg");
  $("weight_lbs_row").classList.toggle("hide", u!=="lbs");
  if(doRecalc) updateProfilePreviewOnly();
}

$("p_height_unit").addEventListener("change", ()=>{
  const to = $("p_height_unit").value;
  convertHeight(to==="cm" ? "ftin" : "cm", to);
  toggleHeightUI(true);
});
$("p_weight_unit").addEventListener("change", ()=>{
  const to = $("p_weight_unit").value;
  convertWeight(to==="kg" ? "lbs" : "kg", to);
  toggleWeightUI(true);
});

/* ===== Profile preview updates ===== */
function updateProfilePreviewOnly(){
  const p=getProfileDraft();

  $("p_bmiLine").textContent = p.bmi? round2(p.bmi) : "—";
  $("p_bmrLine").textContent = p.bmr? Math.round(p.bmr)+" kcal" : "—";
  $("p_tdeeLine").textContent = p.tdee? Math.round(p.tdee)+" kcal" : "—";
  $("p_targetLine").textContent = "Target: " + (p.targetCalories?Math.round(p.targetCalories)+" kcal":"—");

  $("p_targetProtein").value = p.targetProtein ? p.targetProtein : "";

  if(!isDirty("p_targetCalories") && p.targetCalories) $("p_targetCalories").value = p.targetCalories;
  if(!isDirty("p_targetFats") && p.targetFats>=0) $("p_targetFats").value = p.targetFats;
  if(!isDirty("p_targetCarbs") && p.targetCarbs>=0) $("p_targetCarbs").value = p.targetCarbs;

  scheduleRefresh();
}

function calculateTargetsOnly(){
  setDirty("p_targetCalories", false);
  setDirty("p_targetFats", false);
  setDirty("p_targetCarbs", false);

  $("p_targetCalories").value = "";
  $("p_targetFats").value = "";
  $("p_targetCarbs").value = "";

  $("profileCalcHint").style.display="block";
  $("profileSaveHint").style.display="none";

  updateProfilePreviewOnly();
  refreshAll();
}

function saveProfile(){
  try{
    const p=getProfileDraft();
    const map = loadProfiles();
    if(!p.id){
      const id = uid();
      p.id = id;
      setActiveProfileId(id);
    }
    map[p.id] = { ...p, id:p.id, label:(p.name || map[p.id]?.label || "Profile"), updatedAt:Date.now() };
    saveProfiles(map);

    $("profileSaveHint").style.display="block";
    $("profileCalcHint").style.display="none";
    $("profileSavedNote").style.display="block";

    rebuildProfileSelect();
    refreshAll();
  }catch(e){
    alert("Could not save profile. Your browser storage may be restricted.");
  }
}

function loadProfileToUI(){
  const p = getActiveProfile();
  if(!p) return null;

  $("p_name").value=p.name||"";
  $("p_age").value=p.age||"";
  $("p_sex").value=p.sex||"male";

  $("p_height_unit").value=p.heightUnit||"ftin";
  $("p_weight_unit").value=p.weightUnit||"kg";

  $("p_height_cm").value=p.height_cm||"";
  $("p_height_ft").value=p.height_ft||"";
  $("p_height_in").value=p.height_in||"";

  $("p_weight_kg").value=p.weight_kg||"";
  $("p_weight_lbs").value=p.weight_lbs||"";

  $("p_goal").value=p.goal||"loss";
  $("p_activity").value=(p.activity||1.2).toString();
  $("p_dayStartHour").value=(p.dayStartHour ?? 4);
  $("p_macroPreset").value=p.macroPreset||"higherProtein";
  $("p_protMult").value=(p.protMult || 2.2).toString();

  setDirty("p_targetCalories", !!p.dirtyCalories);
  setDirty("p_targetFats", !!p.dirtyFats);
  setDirty("p_targetCarbs", !!p.dirtyCarbs);

  $("p_targetCalories").value = p.dirtyCalories && p.targetCalories ? Math.round(p.targetCalories) : "";
  $("p_targetFats").value = p.dirtyFats && (p.targetFats>=0) ? Math.round(p.targetFats) : "";
  $("p_targetCarbs").value = p.dirtyCarbs && (p.targetCarbs>=0) ? Math.round(p.targetCarbs) : "";

  $("profileSavedNote").style.display="block";

  toggleHeightUI(false);
  toggleWeightUI(false);
  updateProfilePreviewOnly();
  return p;
}

function rebuildProfileSelect(){
  const sel = $("profileSelect");
  const map = loadProfiles();
  const active = getActiveProfileId();

  sel.innerHTML = "";
  const ids = Object.keys(map);
  if(ids.length === 0){
    const opt = document.createElement("option");
    opt.value = "";
    opt.textContent = "No profiles yet";
    sel.appendChild(opt);
    return;
  }
  ids.forEach(id=>{
    const opt = document.createElement("option");
    opt.value = id;
    opt.textContent = map[id]?.name ? map[id].name : (map[id]?.label || "Profile");
    sel.appendChild(opt);
  });
  sel.value = active || ids[0];
}

$("profileSelect").addEventListener("change", ()=>{
  const id = $("profileSelect").value;
  if(!id) return;
  setActiveProfileId(id);
  loadProfileToUI();
  scheduleRefresh();
});

function createProfile(){
  const name = ($("newProfileName").value || "").trim() || "New Profile";
  const map = loadProfiles();
  const id = uid();
  map[id] = { id, name, label:name, createdAt:Date.now() };
  saveProfiles(map);
  setActiveProfileId(id);

  $("newProfileName").value = "";
  rebuildProfileSelect();
  loadProfileToUI();
  scheduleRefresh();
}

function resetCurrentProfile(){
  const id = getActiveProfileId();
  if(!id) return;
  if(!confirm("Reset the current profile data?")) return;

  const map = loadProfiles();
  map[id] = { id, name: (map[id]?.name || "Profile"), label:(map[id]?.label || "Profile"), createdAt:(map[id]?.createdAt||Date.now()) };
  saveProfiles(map);

  ["p_name","p_age","p_height_cm","p_height_ft","p_height_in","p_weight_kg","p_weight_lbs"].forEach(x=>$(x).value="");
  $("p_goal").value="loss";
  $("p_activity").value="1.2";
  $("p_dayStartHour").value="4";
  $("p_sex").value="male";
  $("p_macroPreset").value="higherProtein";
  $("p_protMult").value="2.2";

  setDirty("p_targetCalories", false);
  setDirty("p_targetFats", false);
  setDirty("p_targetCarbs", false);
  $("p_targetCalories").value="";
  $("p_targetFats").value="";
  $("p_targetCarbs").value="";
  $("p_targetProtein").value="";

  $("profileSavedNote").style.display="none";
  toggleHeightUI(false);
  toggleWeightUI(false);
  updateProfilePreviewOnly();
  rebuildProfileSelect();
  scheduleRefresh();
}

[
 "p_name","p_age","p_height_cm","p_height_ft","p_height_in","p_weight_kg","p_weight_lbs",
 "p_goal","p_activity","p_dayStartHour","p_sex","p_macroPreset","p_protMult"
].forEach(id=>{
  $(id).addEventListener("input", updateProfilePreviewOnly);
  $(id).addEventListener("change", updateProfilePreviewOnly);
});
["p_targetCalories","p_targetFats","p_targetCarbs"].forEach(id=>{
  $(id).addEventListener("input", ()=>{
    setDirty(id, true);
    $("profileCalcHint").style.display="none";
    scheduleRefresh();
  });
});

/* ===========================
   Day start hour
=========================== */
function getDefaultLogDate(profile){
  const now=new Date();
  const dayStart=profile?.dayStartHour ?? 4;
  const adjusted=new Date(now);
  if(now.getHours()<dayStart) adjusted.setDate(now.getDate()-1);
  return adjusted.toISOString().slice(0,10);
}

/* ===========================
   Food Logs
=========================== */
function loadAllLogs(){ try{ return JSON.parse(localStorage.getItem(LS_LOG) || "{}"); }catch(e){ return {}; } }
function saveAllLogs(obj){ localStorage.setItem(LS_LOG, JSON.stringify(obj)); }
function getDayLog(dateKey){ const all=loadAllLogs(); return all[dateKey] || { entries: [] }; }
function setDayLog(dateKey, dayLog){ const all=loadAllLogs(); all[dateKey]=dayLog; saveAllLogs(all); }

/* ===========================
   FOOD DATABASE
   (popular items, Fruits separated, Drinks separate, Desserts added, Daal added)
=========================== */
const FOOD = {
  // Proteins
  "Chicken Breast": { unitOptions:["g"], perUnit:{g:{P:31/100, C:0, F:3.6/100, K:165/100}} },
  "Beef (cooked)": { unitOptions:["g"], perUnit:{g:{P:26/100, C:0, F:15/100, K:250/100}} },
  "Fish (generic)": { unitOptions:["g"], perUnit:{g:{P:22/100, C:0, F:5/100, K:120/100}} },
  "Egg": { unitOptions:["pcs"], perUnit:{pcs:{P:6, C:0.6, F:5, K:72}} },
  "Yogurt / Curd": { unitOptions:["g"], perUnit:{g:{P:3.5/100, C:4.7/100, F:3.3/100, K:61/100}} },

  // Daal / Lentils
  "Daal (cooked, 1 cup)": { unitOptions:["cup"], perUnit:{cup:{P:18, C:40, F:1, K:230}} },
  "Daal (cooked, 1/2 cup)": { unitOptions:["half_cup"], perUnit:{half_cup:{P:9, C:20, F:0.5, K:115}} },

  // Carbs (basic)
  "Rice (cooked)": { unitOptions:["g","plate"], perUnit:{
      g:{P:2.7/100, C:28/100, F:0.3/100, K:130/100},
      plate:{P:8, C:90, F:1, K:420}
  }},
  "Roti": { unitOptions:["pcs"], perUnit:{pcs:{P:3.5, C:18, F:3, K:120}} },
  "Paratha": { unitOptions:["pcs"], perUnit:{pcs:{P:6, C:30, F:12, K:260}} },
  "Oats (dry)": { unitOptions:["g"], perUnit:{g:{P:16.9/100, C:66.3/100, F:6.9/100, K:389/100}} },

  // Vegetables
  "Salad": { unitOptions:["cup"], perUnit:{cup:{P:0.5, C:2, F:0.1, K:15}} },
  "Vegetables (mixed)": { unitOptions:["cup"], perUnit:{cup:{P:2, C:5, F:0.2, K:35}} },

  // Fats
  "Butter": { unitOptions:["tbsp"], perUnit:{tbsp:{P:0.12, C:0.01, F:11.5, K:102}} },
  "Olive Oil": { unitOptions:["tbsp"], perUnit:{tbsp:{P:0, C:0, F:13.5, K:119}} },
  "Ghee": { unitOptions:["tbsp"], perUnit:{tbsp:{P:0, C:0, F:14, K:126}} },

  // Snacks (popular)
  "Peanut Butter": { unitOptions:["tbsp"], perUnit:{tbsp:{P:3.5, C:4, F:8, K:100}} },
  "Almonds": { unitOptions:["g"], perUnit:{g:{P:21.2/100, C:21.6/100, F:49.9/100, K:579/100}} },
  "Peanuts": { unitOptions:["g"], perUnit:{g:{P:25.8/100, C:16.1/100, F:49.2/100, K:567/100}} },
  "Biscuits (2 pcs)": { unitOptions:["serving"], perUnit:{serving:{P:2, C:20, F:6, K:140}} },
  "Chips (small pack)": { unitOptions:["pack"], perUnit:{pack:{P:3, C:18, F:10, K:170}} },

  // Fruits (separated)
  "Banana": { unitOptions:["pcs"], perUnit:{pcs:{P:1.3, C:27, F:0.4, K:105}} },
  "Apple": { unitOptions:["pcs"], perUnit:{pcs:{P:0.5, C:25, F:0.3, K:95}} },
  "Orange": { unitOptions:["pcs"], perUnit:{pcs:{P:1.2, C:15.4, F:0.2, K:62}} },
  "Mango (1 cup slices)": { unitOptions:["cup"], perUnit:{cup:{P:1.4, C:25, F:0.6, K:99}} },
  "Grapes (1 cup)": { unitOptions:["cup"], perUnit:{cup:{P:1.1, C:27.3, F:0.2, K:104}} },

  // Drinks (separate section)
  "Milk Tea (1 cup)": { unitOptions:["cup"], perUnit:{cup:{P:2, C:10, F:3, K:80}} },
  "Black Coffee (no sugar)": { unitOptions:["cup"], perUnit:{cup:{P:0.3, C:0, F:0, K:2}} },
  "Coffee with milk (no sugar)": { unitOptions:["cup"], perUnit:{cup:{P:3, C:5, F:2, K:50}} },
  "Soft Drink (330 ml)": { unitOptions:["can"], perUnit:{can:{P:0, C:35, F:0, K:140}} },

  // Meals
  "Khichuri": { unitOptions:["plate"], perUnit:{plate:{P:14, C:70, F:12, K:450}} },
  "Biryani (general)": { unitOptions:["plate"], perUnit:{plate:{P:20, C:85, F:15, K:600}} },
  "Shawarma (wrap)": { unitOptions:["pcs"], perUnit:{pcs:{P:30, C:40, F:20, K:450}} },

  // Desserts (popular)
  "Cake slice": { unitOptions:["slice"], perUnit:{slice:{P:4, C:45, F:15, K:330}} },
  "Chocolate cube": { unitOptions:["pcs"], perUnit:{pcs:{P:1, C:8, F:6, K:90}} },
  "Ice cream (1 cup)": { unitOptions:["cup"], perUnit:{cup:{P:5, C:30, F:14, K:270}} },
};

const CATEGORY_ITEMS = {
  "Protein": ["Chicken Breast","Beef (cooked)","Fish (generic)","Egg","Yogurt / Curd"],
  "Daal / Lentils": ["Daal (cooked, 1 cup)","Daal (cooked, 1/2 cup)"],
  "Carbs": ["Rice (cooked)","Roti","Paratha","Oats (dry)","Khichuri","Biryani (general)"],
  "Vegetables": ["Salad","Vegetables (mixed)"],
  "Fats": ["Butter","Olive Oil","Ghee"],
  "Snacks": ["Peanut Butter","Almonds","Peanuts","Biscuits (2 pcs)","Chips (small pack)"],
  "Fruits": ["Banana","Apple","Orange","Mango (1 cup slices)","Grapes (1 cup)"],
  "Drinks": ["Milk Tea (1 cup)","Black Coffee (no sugar)","Coffee with milk (no sugar)","Soft Drink (330 ml)"],
  "Desserts": ["Cake slice","Chocolate cube","Ice cream (1 cup)"],
  "Meals": ["Shawarma (wrap)"],
};

/* ===== Food compute ===== */
function computeFood(foodName, qty, unit){
  const item=FOOD[foodName];
  if(!item) return {P:0,C:0,F:0,K:0};
  const map=item.perUnit[unit];
  if(!map) return {P:0,C:0,F:0,K:0};
  return { P: map.P*qty, C: map.C*qty, F: map.F*qty, K: map.K*qty };
}

/* ===== Food UI ===== */
function buildCategorySelect(){
  const sel=$("entryCategory");
  sel.innerHTML="";
  Object.keys(CATEGORY_ITEMS).forEach(cat=>{
    const opt=document.createElement("option");
    opt.value=cat; opt.textContent=cat;
    sel.appendChild(opt);
  });
}
function buildFoodSelectForCategory(category){
  const sel=$("entryFood");
  sel.innerHTML="";
  (CATEGORY_ITEMS[category]||[]).forEach(name=>{
    const opt=document.createElement("option");
    opt.value=name; opt.textContent=name;
    sel.appendChild(opt);
  });
}
function buildUnitSelect(foodName){
  const uSel=$("entryUnit");
  uSel.innerHTML="";
  (FOOD[foodName]?.unitOptions || ["g"]).forEach(u=>{
    const opt=document.createElement("option");
    opt.value=u; opt.textContent=u;
    uSel.appendChild(opt);
  });
}
function updateEntryPreview(){
  const food=$("entryFood").value;
  const unit=$("entryUnit").value;
  const qty=n($("entryQty").value);
  const t=computeFood(food, qty, unit);
  $("entryPrevP").textContent=round1(t.P);
  $("entryPrevC").textContent=round1(t.C);
  $("entryPrevF").textContent=round1(t.F);
  $("entryPrevK").textContent=Math.round(t.K);
}
$("entryCategory").addEventListener("change", ()=>{
  buildFoodSelectForCategory($("entryCategory").value);
  buildUnitSelect($("entryFood").value);
  updateEntryPreview();
});
$("entryFood").addEventListener("change", ()=>{
  buildUnitSelect($("entryFood").value);
  updateEntryPreview();
});
$("entryUnit").addEventListener("change", updateEntryPreview);
$("entryQty").addEventListener("input", updateEntryPreview);

function computeTotalsFromEntries(dateKey){
  const day=getDayLog(dateKey);
  let total={P:0,C:0,F:0,K:0};
  day.entries.forEach(e=>{
    const t = computeFood(e.food, n(e.qty), e.unit);
    total = {P:total.P+t.P, C:total.C+t.C, F:total.F+t.F, K:total.K+t.K};
  });
  return total;
}

function addEntry(){
  const profile=getActiveProfile() || getProfileDraft();
  const dateKey=$("logDate").value || getDefaultLogDate(profile);
  const day=getDayLog(dateKey);

  const category=$("entryCategory").value;
  const food=$("entryFood").value;
  const unit=$("entryUnit").value;
  const qty=n($("entryQty").value);
  if(!food || qty<=0){ alert("Select a food and enter a quantity > 0."); return; }

  day.entries.push({ id: uid(), meal: $("mealType").value, category, food, unit, qty });
  setDayLog(dateKey, day);

  $("entryQty").value="";
  renderEntries();
  scheduleRefresh();
}

function renderEntries(){
  const profile=getActiveProfile() || getProfileDraft();
  const dateKey=$("logDate").value || getDefaultLogDate(profile);
  const day=getDayLog(dateKey);

  const tb=$("entriesTbody");
  tb.innerHTML="";

  day.entries.forEach(e=>{
    const t=computeFood(e.food, n(e.qty), e.unit);
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${e.meal}</td>
      <td>${e.category || ""}</td>
      <td>${e.food}</td>
      <td><input class="miniInput" type="number" min="0" step="1" value="${e.qty}" data-id="${e.id}" data-field="qty"></td>
      <td>${e.unit}</td>
      <td>${round1(t.P)}</td>
      <td>${round1(t.C)}</td>
      <td>${round1(t.F)}</td>
      <td>${Math.round(t.K)}</td>
      <td><button class="actionBtn" data-id="${e.id}" data-action="del">Delete</button></td>
    `;
    tb.appendChild(tr);
  });

  tb.querySelectorAll('input[data-field="qty"]').forEach(inp=>{
    inp.addEventListener("input", ()=>{
      const id=inp.dataset.id;
      const day2=getDayLog(dateKey);
      const row=day2.entries.find(x=>x.id===id);
      if(row){
        row.qty = n(inp.value);
        setDayLog(dateKey, day2);
        renderEntries();
        scheduleRefresh();
      }
    });
  });
  tb.querySelectorAll('button[data-action="del"]').forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const id=btn.dataset.id;
      const day2=getDayLog(dateKey);
      day2.entries = day2.entries.filter(x=>x.id!==id);
      setDayLog(dateKey, day2);
      renderEntries();
      scheduleRefresh();
    });
  });

  const total=computeTotalsFromEntries(dateKey);
  $("liveP").textContent = round1(total.P) + " g";
  $("liveC").textContent = round1(total.C) + " g";
  $("liveF").textContent = round1(total.F) + " g";
  $("liveK").textContent = Math.round(total.K) + " kcal";
}

function saveDay(){
  const profile=getActiveProfile() || getProfileDraft();
  const dateKey=$("logDate").value || getDefaultLogDate(profile);
  alert("Saved for the Day ✔️ ("+dateKey+")");
}
function resetFoodLogs(){
  const profile=getActiveProfile() || getProfileDraft();
  const dateKey=$("logDate").value || getDefaultLogDate(profile);
  if(!confirm("Reset all food entries for "+dateKey+"?")) return;
  setDayLog(dateKey, { entries: [] });
  renderEntries();
  scheduleRefresh();
}

/* ===========================
   Lifestyle (MULTI-WORKOUT)
=========================== */
function loadAllLifestyle(){ try{ return JSON.parse(localStorage.getItem(LS_LIFE) || "{}"); }catch(e){ return {}; } }
function saveAllLifestyle(obj){ localStorage.setItem(LS_LIFE, JSON.stringify(obj)); }

function emptyLifestyle(){
  return {
    workouts: [], // [{id,type,split,mins,burn}]
    sleepHours:0, sleepGoal:8,
    waterLiters:0, waterGoal:3
  };
}
function getLifestyle(dateKey){
  const all=loadAllLifestyle();
  return all[dateKey] || emptyLifestyle();
}
function setLifestyle(dateKey, data){
  const all=loadAllLifestyle();
  all[dateKey]=data;
  saveAllLifestyle(all);
}

const BURN_PER_MIN = { walking:4.0, running:10.0, cycling:8.0, aerobic:7.0, cardio:7.5, hiit:12.0, strength:6.5 };

function calcWorkoutBurn(type, mins){
  const per=BURN_PER_MIN[type] ?? 0;
  return Math.round(per * mins);
}
function workoutLabel(w){
  if(w.type==="strength"){
    const map = {
      chest_triceps:"Chest + Triceps", back_biceps:"Back + Biceps",
      shoulders_forearms:"Shoulders + Forearms", legs:"Legs", fullbody:"Full body"
    };
    return "Strength";
  }
  const opt = document.querySelector(`#workoutType option[value="${w.type}"]`);
  return opt ? opt.textContent : w.type;
}
function updateBurnPreview(){
  const type=$("workoutType").value;
  const mins=n($("workoutMins").value);
  $("strengthSplitWrap").classList.toggle("hide", type!=="strength");
  $("burnPreview").textContent = calcWorkoutBurn(type, mins);
}

$("workoutType").addEventListener("change", updateBurnPreview);
$("workoutMins").addEventListener("input", updateBurnPreview);
$("strengthSplit").addEventListener("change", updateBurnPreview);

function addWorkout(){
  const profile=getActiveProfile() || getProfileDraft();
  const dateKey=$("lifeDate").value || getDefaultLogDate(profile);
  const data=getLifestyle(dateKey);

  const type=$("workoutType").value;
  const mins=n($("workoutMins").value);
  const split = (type==="strength") ? $("strengthSplit").value : "";
  if(mins<=0){ alert("Enter workout minutes > 0"); return; }

  const burn = calcWorkoutBurn(type, mins);
  data.workouts.push({ id: uid(), type, split, mins, burn });
  setLifestyle(dateKey, data);

  $("workoutMins").value="";
  renderWorkouts();
  updateLifestyleSummaryCards();
  scheduleRefresh();
}

function renderWorkouts(){
  const profile=getActiveProfile() || getProfileDraft();
  const dateKey=$("lifeDate").value || getDefaultLogDate(profile);
  const data=getLifestyle(dateKey);

  const tb=$("workoutsTbody");
  tb.innerHTML="";

  data.workouts.forEach(w=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${workoutLabel(w)}</td>
      <td>${w.type==="strength" ? (w.split || "-") : "-"}</td>
      <td>${w.mins}</td>
      <td>${w.burn}</td>
      <td><button class="actionBtn" data-id="${w.id}">Delete</button></td>
    `;
    tb.appendChild(tr);
  });

  tb.querySelectorAll("button.actionBtn").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const id=btn.dataset.id;
      const data2=getLifestyle(dateKey);
      data2.workouts = data2.workouts.filter(x=>x.id!==id);
      setLifestyle(dateKey, data2);
      renderWorkouts();
      updateLifestyleSummaryCards();
      scheduleRefresh();
    });
  });

  const totalBurn = data.workouts.reduce((s,x)=>s+n(x.burn),0);
  $("burnTotalPreview").textContent = Math.round(totalBurn);
}

function updateLifestyleUI(){
  const profile=getActiveProfile() || getProfileDraft();
  const dateKey=$("lifeDate").value || getDefaultLogDate(profile);
  const data=getLifestyle(dateKey);

  $("sleepHours").value=data.sleepHours ?? 0;
  $("sleepGoal").value(String(data.sleepGoal ?? 8));
  $("waterLiters").value=data.waterLiters ?? 0;
  $("waterGoal").value(String(data.waterGoal ?? 3));

  renderWorkouts();
  updateLifestyleSummaryCards();
  updateBurnPreview();
}

function updateLifestyleSummaryCards(){
  const profile=getActiveProfile() || getProfileDraft();
  const dateKey=$("lifeDate").value || getDefaultLogDate(profile);
  const data=getLifestyle(dateKey);

  const totalBurn = data.workouts.reduce((s,x)=>s+n(x.burn),0);
  const totalMins = data.workouts.reduce((s,x)=>s+n(x.mins),0);
  const count = data.workouts.length;

  // Lifestyle tab summary
  $("lifeWorkoutLine").textContent = count ? `${count} workout(s) • ${totalMins} min` : "No workout";
  $("lifeWorkoutLineSub").textContent = `Total burn: ${Math.round(totalBurn)} kcal`;

  $("lifeSleepWaterLine").textContent = `${n(data.sleepHours)||0}h sleep • ${n(data.waterLiters)||0}L water`;
  $("lifeSleepWaterLineSub").textContent = `Goals: ${n(data.sleepGoal)||0}h • ${n(data.waterGoal)||0}L`;

  // Dashboard summary (same day key used by dashboard refresh)
  $("dashLifeWorkout").textContent = count ? `${count} workout(s) • ${totalMins} min` : "No workout";
  $("dashLifeWorkoutSub").textContent = `Burn: ${Math.round(totalBurn)} kcal`;

  $("dashLifeSleepWater").textContent = `${n(data.sleepHours)||0}h sleep • ${n(data.waterLiters)||0}L water`;
  $("dashLifeSleepWaterSub").textContent = `Goals: ${n(data.sleepGoal)||0}h • ${n(data.waterGoal)||0}L`;
}

function saveLifestyle(){
  const profile=getActiveProfile() || getProfileDraft();
  const dateKey=$("lifeDate").value || getDefaultLogDate(profile);
  const data=getLifestyle(dateKey);

  data.sleepHours=n($("sleepHours").value);
  data.sleepGoal=n($("sleepGoal").value);
  data.waterLiters=n($("waterLiters").value);
  data.waterGoal=n($("waterGoal").value);

  setLifestyle(dateKey, data);

  $("lifeSavedNote").style.display="block";
  updateLifestyleSummaryCards();
  scheduleRefresh();
}
function resetLifestyle(){
  const profile=getActiveProfile() || getProfileDraft();
  const dateKey=$("lifeDate").value || getDefaultLogDate(profile);
  if(!confirm("Reset lifestyle (workouts + sleep + water) for "+dateKey+"?")) return;

  setLifestyle(dateKey, emptyLifestyle());
  $("lifeSavedNote").style.display="none";
  updateLifestyleUI();
  scheduleRefresh();
}

/* ===========================
   BMI Bar
=========================== */
function updateBMIBar(bmi){
  const fill=$("bmiFill");
  const pin=$("bmiPin");
  if(!bmi || bmi<=0){ fill.style.width="0%"; pin.style.left="0%"; pin.textContent="▲ You"; return; }
  const pct=clamp(((bmi-10)/(40-10))*100, 0, 100);
  fill.style.width=pct+"%";
  pin.style.left=pct+"%";
  pin.textContent="▲ You ("+round1(bmi)+")";
}

/* ===========================
   Dashboard refresh
=========================== */
function refreshAll(){
  const profile = getActiveProfile() || getProfileDraft();
  const hasSavedProfile = !!getActiveProfile();

  $("needProfileNote").style.display = hasSavedProfile ? "none" : "block";

  const dashDate = getDefaultLogDate(profile);

  if(!$("logDate").value) $("logDate").value = dashDate;
  if(!$("lifeDate").value) $("lifeDate").value = dashDate;

  const foodDateKey = $("logDate").value || dashDate;
  const lifeDateKey = $("lifeDate").value || dashDate;

  const total=computeTotalsFromEntries(foodDateKey);

  const life = getLifestyle(lifeDateKey);
  const burn = life.workouts.reduce((s,x)=>s+n(x.burn),0);
  const netK = total.K - burn;

  $("dashCalories").textContent = Math.round(total.K) + " kcal";
  $("dashBurn").textContent = Math.round(burn) + " kcal";
  $("dashNet").textContent = Math.round(netK);

  $("dashProtein").textContent = round1(total.P) + " g";
  $("dashCarbs").textContent   = round1(total.C) + " g";
  $("dashFat").textContent     = round1(total.F) + " g";

  const tCal=n(profile.targetCalories);
  const tP=n(profile.targetProtein);
  const tC=n(profile.targetCarbs);
  const tF=n(profile.targetFats);

  $("dashCalTarget").textContent  = tCal?Math.round(tCal):0;
  $("dashProtTarget").textContent = tP?Math.round(tP):0;
  $("dashCarbTarget").textContent = tC?Math.round(tC):0;
  $("dashFatTarget").textContent  = tF?Math.round(tF):0;

  if(!tCal){
    $("dashCalBalance").textContent="—";
    $("dashCalBalanceMsg").textContent="Use Calculate Targets in Profile tab.";
    $("dashCalBalance").className="big";
  }else{
    const diff=Math.round(netK - tCal);
    if(diff>0){
      $("dashCalBalance").textContent="+"+diff+" kcal";
      $("dashCalBalance").className="big accentBad";
      $("dashCalBalanceMsg").textContent="Over target (net calories above target).";
    }else if(diff<0){
      $("dashCalBalance").textContent=diff+" kcal";
      $("dashCalBalance").className="big accentGood";
      $("dashCalBalanceMsg").textContent="Under target (net calories below target).";
    }else{
      $("dashCalBalance").textContent="0 kcal";
      $("dashCalBalance").className="big";
      $("dashCalBalanceMsg").textContent="Exactly on target.";
    }
  }

  function setMacroBalanceNumeric(diffG, valEl, msgEl, label){
    if(!isFinite(diffG)){
      valEl.textContent="—"; valEl.className="big";
      msgEl.textContent="—"; return;
    }
    if(diffG>0){
      valEl.textContent="+"+diffG+" g";
      valEl.className="big accentBad";
      msgEl.textContent="Over target " + label + ".";
    }else if(diffG<0){
      valEl.textContent=diffG+" g";
      valEl.className="big accentGood";
      msgEl.textContent="Under target " + label + ".";
    }else{
      valEl.textContent="0 g";
      valEl.className="big";
      msgEl.textContent="Exactly on target " + label + ".";
    }
  }

  setMacroBalanceNumeric(Math.round(total.P - tP), $("dashProtBalance"), $("dashProtBalanceMsg"), "protein");
  setMacroBalanceNumeric(Math.round(total.C - tC), $("dashCarbBalance"), $("dashCarbBalanceMsg"), "carbs");
  setMacroBalanceNumeric(Math.round(total.F - tF), $("dashFatBalance"), $("dashFatBalanceMsg"), "fat");

  $("dashBMI").textContent = profile.bmi ? round2(profile.bmi) : "—";
  $("dashBMR").textContent = profile.bmr ? Math.round(profile.bmr) : "—";
  $("dashTDEE").textContent = profile.tdee ? Math.round(profile.tdee) : "—";
  updateBMIBar(profile.bmi);

  if(macroChart){
    macroChart.data.datasets[0].data = [round1(total.P), round1(total.C), round1(total.F)];
    macroChart.update();
  }

  $("dashProfileName").textContent = (profile.name || profile.label || "—");
  $("dashProfileMeta").textContent = (profile.age ? ("Age " + profile.age) : "—") + " • " + (profile.sex || "—");
  $("dashProtMult").textContent = (profile.protMult ? profile.protMult : "—");

  // ✅ keep lifestyle summaries synced
  updateLifestyleSummaryCards();
}

/* ===========================
   Reset only today / Reset everything
=========================== */
function resetOnlyToday(){
  const profile = getActiveProfile() || getProfileDraft();
  const dateKey = getDefaultLogDate(profile);

  if(!confirm("Reset ONLY today's food log and lifestyle for " + dateKey + "?")) return;

  setDayLog(dateKey, { entries: [] });
  setLifestyle(dateKey, emptyLifestyle());

  renderEntries();
  updateLifestyleUI();
  refreshAll();
}

function resetEverything(){
  if(!confirm("Reset EVERYTHING? This will delete ALL profiles, logs, and lifestyle data on this device.")) return;

  localStorage.removeItem(LS_PROFILES);
  localStorage.removeItem(LS_ACTIVE_PROFILE);
  localStorage.removeItem(LS_LOG);
  localStorage.removeItem(LS_LIFE);

  location.reload();
}

/* ===========================
   PDF
=========================== */
async function savePDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit:"pt", format:"a4" });
  const profile = getActiveProfile() || getProfileDraft();
  const dateKey = getDefaultLogDate(profile);

  const total = computeTotalsFromEntries(dateKey);
  const life = getLifestyle(dateKey);
  const burn = life.workouts.reduce((s,x)=>s+n(x.burn),0);
  const netK = total.K - burn;

  const pageW = doc.internal.pageSize.getWidth();
  let y=46;

  doc.setFont("helvetica","bold"); doc.setFontSize(18);
  doc.text("Nowshad's Macro Calculator — Report", 40, y); y+=18;

  doc.setFont("helvetica","normal"); doc.setFontSize(10);
  doc.text("Date: " + dateKey + "   |   Generated: " + new Date().toLocaleString(), 40, y); y+=20;

  doc.setFont("helvetica","bold"); doc.setFontSize(12);
  doc.text("Profile Summary", 40, y); y+=10;
  doc.setDrawColor(220); doc.setLineWidth(1); doc.line(40,y,pageW-40,y); y+=12;

  doc.setFont("helvetica","normal"); doc.setFontSize(11);
  [
    `Name: ${profile.name || "—"}   |   Age: ${profile.age || "—"}   |   Sex: ${profile.sex || "—"}`,
    `BMI: ${profile.bmi ? round2(profile.bmi) : "—"}   |   BMR: ${profile.bmr ? Math.round(profile.bmr) : "—"} kcal   |   TDEE: ${profile.tdee ? Math.round(profile.tdee) : "—"} kcal`,
    `Goal: ${profile.goal || "—"}   |   Target Calories: ${profile.targetCalories ? Math.round(profile.targetCalories) : "—"} kcal`,
    `Targets — Protein: ${profile.targetProtein || "—"} g   |   Carbs: ${profile.targetCarbs || "—"} g   |   Fats: ${profile.targetFats || "—"} g`,
  ].forEach(t=>{ doc.text(t,40,y); y+=16; });

  y+=6;
  doc.setFont("helvetica","bold"); doc.text("Lifestyle", 40, y); y+=14;
  doc.setFont("helvetica","normal");

  const workoutLine = life.workouts.length
    ? `Workouts: ${life.workouts.length} session(s), ${life.workouts.reduce((s,x)=>s+n(x.mins),0)} min, Burn ${Math.round(burn)} kcal`
    : "Workouts: None";
  doc.text(workoutLine, 40, y); y+=14;

  doc.text(`Sleep: ${n(life.sleepHours)||0} h (Goal ${n(life.sleepGoal)||0} h) • Water: ${n(life.waterLiters)||0} L (Goal ${n(life.waterGoal)||0} L)`, 40, y); y+=18;

  doc.setFont("helvetica","bold"); doc.text("Today’s Totals", 40, y); y+=14;
  doc.setFont("helvetica","normal");
  doc.text(`Calories eaten: ${Math.round(total.K)} kcal   |   Burned: ${Math.round(burn)} kcal   |   Net: ${Math.round(netK)} kcal`, 40, y); y+=14;
  doc.text(`Protein: ${round1(total.P)} g   |   Carbs: ${round1(total.C)} g   |   Fat: ${round1(total.F)} g`, 40, y);
  y+=18;

  doc.setFont("helvetica","bold"); doc.text("Macro Chart", 40, y); y+=10;
  const imgData = $("macroChart").toDataURL("image/png", 1.0);
  doc.addImage(imgData, "PNG", 40, y, pageW-80, 220);

  doc.save("Nowshad_Macro_Report.pdf");
}

/* ===========================
   Init
=========================== */
(function init(){
  ensureDefaultProfile();
  rebuildProfileSelect();
  loadProfileToUI();

  const p = getActiveProfile() || getProfileDraft();
  const today = getDefaultLogDate(p);

  $("logDate").value = today;
  $("lifeDate").value = today;

  $("logDate").addEventListener("change", ()=>{ renderEntries(); scheduleRefresh(); });
  $("lifeDate").addEventListener("change", ()=>{ updateLifestyleUI(); scheduleRefresh(); });

  buildCategorySelect();
  const firstCat = Object.keys(CATEGORY_ITEMS)[0] || "Protein";
  $("entryCategory").value = firstCat;
  buildFoodSelectForCategory(firstCat);
  buildUnitSelect($("entryFood").value);
  updateEntryPreview();

  updateLifestyleUI();
  renderEntries();
  refreshAll();
})();
</script>
</body>
</html>
